
const fs = require('fs');
const config = require('../config');
const { cmd, commands } = require('../command');
const { runtime } = require('../lib/functions');
const axios = require('axios');

cmd({
    pattern: "menu",
    desc: "Show interactive menu system",
    category: "menu",
    react: "ğŸ§¾",
    filename: __filename
},  async (conn, mek, m, { from, senderNumber, pushname, reply }) => {
    try {
      let uptime = (process.uptime() / 60).toFixed(2);
      let used = process.memoryUsage().heapUsed / 1024 / 1024;
      let totalRam = Math.round(require('os').totalmem / 1024 / 1024);
      let ramUsage = `${Math.round(used * 100) / 100}MB / ${totalRam}MB`;

      // Convert uptime to hours, minutes, seconds
      let uptimeSeconds = Math.floor(process.uptime());
      let hours = Math.floor(uptimeSeconds / 3600);
      let minutes = Math.floor((uptimeSeconds % 3600) / 60);
      let seconds = uptimeSeconds % 60;
      let formattedUptime = hours > 0 ? `${hours} hours, ${minutes} minutes, ${seconds} seconds` : `${minutes} minutes, ${seconds} seconds`;
        // Count total commands
        const totalCommands = Object.keys(commands).length;
        
        const menuCaption = `ğŸ‘‹ *HELLO*
*â•­â”€ã€Œ á´„á´á´á´á´€É´á´…êœ± á´˜á´€É´á´‡ÊŸã€*
*â”‚â—ˆ ğšğ™°ğ™¼ ğš„ğš‚ğ™°ğ™¶ğ™´ -* ${ramUsage}
*â”‚â—ˆ ğšğš„ğ™½ğšƒğ™¸ğ™¼ğ™´ -* ${formattedUptime}
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚â›µ LIST MENU*
*â”‚   â”€â”€â”€â”€â”€â”€â”€*
*â”‚ 1   OWNER*
*â”‚ 2   MAIN*
*â”‚ 3   DOWNLOAD*
*â”‚ 4   SEARCH*
*â”‚ 5   AI*
*â”‚ 6   CONVERT*
*â”‚ 7   FUN*
*â”‚ 8   GROUP*
*â”‚ 9   ANEMI*
*â”‚ 10   OTHER*
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*ğŸŒŸ Reply the Number you want to select*

*ã‹› ğ™¿ğ™¾ğš†ğ™´ğšğ™³ ğ™±ğšˆ ğ™¿_ğ™¸_ğ™º_ğ™¾ ã€½ï¸*`;

        const sendMenuImage = async () => {
            try {
                return await conn.sendMessage(
                    from,
                    {
                        image: { url: config.MAINMENU_IMG },
                        caption: menuCaption,
                        contextInfo: contextInfo
                    },
                    { quoted: mek }
                );
            } catch (e) {
                console.log('Image send failed, falling back to text');
                return await conn.sendMessage(
                    from,
                    { text: menuCaption, contextInfo: contextInfo },
                    { quoted: mek }
                );
            }
        };

        // Send image with timeout
        let sentMsg;
        try {
            sentMsg = await Promise.race([
                sendMenuImage(),
                new Promise((_, reject) => setTimeout(() => reject(new Error('Image send timeout')), 10000))
            ]);
        } catch (e) {
            console.log('Menu send error:', e);
            sentMsg = await conn.sendMessage(
                from,
                { text: menuCaption, contextInfo: contextInfo },
                { quoted: mek }
            );
        }
        
        const messageID = sentMsg.key.id;

        // Menu data (complete version)
        const menuData = {
            '1': {
                title: "ğŸ“¥ *Download Menu* ğŸ“¥",
                image: "https://raw.githubusercontent.com/Manmitha96/BOT-PHOTOS/refs/heads/main/BotMenuPhoto/Owner.png",
                content: `ğŸ‘‹ *HELLO*
*â•­â”€ã€Œ á´„á´á´á´á´€É´á´…êœ± á´˜á´€É´á´‡ÊŸã€*
*â”‚â—ˆ ğšğ™°ğ™¼ ğš„ğš‚ğ™°ğ™¶ğ™´ -* 56.41MB / 32050MB
*â”‚â—ˆ ğšğš„ğ™½ğšƒğ™¸ğ™¼ğ™´ -* 11 hours, 56 minutes, 31 seconds
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚âšœï¸ OWNER Command List:*
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚Command:* restart
*â”‚Use:* .restart
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚Command:* block
*â”‚Use:* .block <reply to user>
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚Command:* left
*â”‚Use:* .left
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚Command:* join
*â”‚Use:* .join <grouplink>
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

*â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*
*â”‚Command:* update
*â”‚Use:* .update
*â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â—â–º*

â  *Total Commands in OWNER*: 5

*Reply with another number (1-10) for more categories!*

*ã‹› ğ™¿ğ™¾ğš†ğ™´ğšğ™³ ğ™±ğšˆ ğ™¿_ğ™¸_ğ™º_ğ™¾ ã€½ï¸*
${config.FOOTER}`,
                image: true
                imageUrl: "https://raw.githubusercontent.com/Manmitha96/BOT-PHOTOS/refs/heads/main/BotMenuPhoto/Owner.png"
            },
            '2': {
                title: "ğŸ‘¥ *Group Menu* ğŸ‘¥",
                content: `â•­â”â”â”ã€” *ğ™¶ğšğ™¾ğš„ğ™¿ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ› ï¸ *Management*
â”ƒâ˜…â”‚ â€¢ grouplink
â”ƒâ˜…â”‚ â€¢ kickall
â”ƒâ˜…â”‚ â€¢ kickall2
â”ƒâ˜…â”‚ â€¢ kickall3
â”ƒâ˜…â”‚ â€¢ add @user
â”ƒâ˜…â”‚ â€¢ remove @user
â”ƒâ˜…â”‚ â€¢ kick @user
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ âš¡ *Admin Tools*
â”ƒâ˜…â”‚ â€¢ promote @user
â”ƒâ˜…â”‚ â€¢ demote @user
â”ƒâ˜…â”‚ â€¢ dismiss 
â”ƒâ˜…â”‚ â€¢ revoke
â”ƒâ˜…â”‚ â€¢ mute [time]
â”ƒâ˜…â”‚ â€¢ unmute
â”ƒâ˜…â”‚ â€¢ lockgc
â”ƒâ˜…â”‚ â€¢ unlockgc
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ·ï¸ *Tagging*
â”ƒâ˜…â”‚ â€¢ tag @user
â”ƒâ˜…â”‚ â€¢ hidetag [msg]
â”ƒâ˜…â”‚ â€¢ tagall
â”ƒâ˜…â”‚ â€¢ tagadmins
â”ƒâ˜…â”‚ â€¢ invite
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '3': {
                title: "ğŸ˜„ *Fun Menu* ğŸ˜„",
                content: `â•­â”â”â”ã€” *ğ™µğš„ğ™½ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ­ *Interactive*
â”ƒâ˜…â”‚ â€¢ shapar
â”ƒâ˜…â”‚ â€¢ rate @user
â”ƒâ˜…â”‚ â€¢ insult @user
â”ƒâ˜…â”‚ â€¢ hack @user
â”ƒâ˜…â”‚ â€¢ ship @user1 @user2
â”ƒâ˜…â”‚ â€¢ character
â”ƒâ˜…â”‚ â€¢ pickup
â”ƒâ˜…â”‚ â€¢ joke
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ˜‚ *Reactions*
â”ƒâ˜…â”‚ â€¢ hrt
â”ƒâ˜…â”‚ â€¢ hpy
â”ƒâ˜…â”‚ â€¢ syd
â”ƒâ˜…â”‚ â€¢ anger
â”ƒâ˜…â”‚ â€¢ shy
â”ƒâ˜…â”‚ â€¢ kiss
â”ƒâ˜…â”‚ â€¢ mon
â”ƒâ˜…â”‚ â€¢ cunfuzed
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '4': {
                title: "ğŸ‘‘ *Owner Menu* ğŸ‘‘",
                content: `â•­â”â”â”ã€” *ğ™¾ğš†ğ™½ğ™´ğš ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ âš ï¸ *Restricted*
â”ƒâ˜…â”‚ â€¢ block @user
â”ƒâ˜…â”‚ â€¢ unblock @user
â”ƒâ˜…â”‚ â€¢ fullpp [img]
â”ƒâ˜…â”‚ â€¢ setpp [img]
â”ƒâ˜…â”‚ â€¢ restart
â”ƒâ˜…â”‚ â€¢ shutdown
â”ƒâ˜…â”‚ â€¢ updatecmd
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ â„¹ï¸ *Info Tools*
â”ƒâ˜…â”‚ â€¢ gjid
â”ƒâ˜…â”‚ â€¢ jid @user
â”ƒâ˜…â”‚ â€¢ listcmd
â”ƒâ˜…â”‚ â€¢ allmenu
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '5': {
                title: "ğŸ¤– *AI Menu* ğŸ¤–",
                content: `â•­â”â”â”ã€” *ğ™°ğ™¸ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ’¬ *Chat AI*
â”ƒâ˜…â”‚ â€¢ ai [query]
â”ƒâ˜…â”‚ â€¢ gpt3 [query]
â”ƒâ˜…â”‚ â€¢ gpt2 [query]
â”ƒâ˜…â”‚ â€¢ gptmini [query]
â”ƒâ˜…â”‚ â€¢ gpt [query]
â”ƒâ˜…â”‚ â€¢ meta [query]
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ–¼ï¸ *Image AI*
â”ƒâ˜…â”‚ â€¢ imagine [text]
â”ƒâ˜…â”‚ â€¢ imagine2 [text]
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ” *Specialized*
â”ƒâ˜…â”‚ â€¢ blackbox [query]
â”ƒâ˜…â”‚ â€¢ luma [query]
â”ƒâ˜…â”‚ â€¢ dj [query]
â”ƒâ˜…â”‚ â€¢ khan [query]
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '6': {
                title: "ğŸ *Anime Menu* ğŸ",
                content: `â•­â”â”â”ã€” *ğ™°ğ™½ğ™¸ğ™¼ğ™´ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ–¼ï¸ *Images*
â”ƒâ˜…â”‚ â€¢ fack
â”ƒâ˜…â”‚ â€¢ dog
â”ƒâ˜…â”‚ â€¢ awoo
â”ƒâ˜…â”‚ â€¢ garl
â”ƒâ˜…â”‚ â€¢ waifu
â”ƒâ˜…â”‚ â€¢ neko
â”ƒâ˜…â”‚ â€¢ megnumin
â”ƒâ˜…â”‚ â€¢ maid
â”ƒâ˜…â”‚ â€¢ loli
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ­ *Characters*
â”ƒâ˜…â”‚ â€¢ animegirl
â”ƒâ˜…â”‚ â€¢ animegirl1-5
â”ƒâ˜…â”‚ â€¢ anime1-5
â”ƒâ˜…â”‚ â€¢ foxgirl
â”ƒâ˜…â”‚ â€¢ naruto
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '7': {
                title: "ğŸ”„ *Convert Menu* ğŸ”„",
                content: `â•­â”â”â”ã€” *ğ™²ğ™¾ğ™½ğš…ğ™´ğšğšƒ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ–¼ï¸ *Media*
â”ƒâ˜…â”‚ â€¢ sticker [img]
â”ƒâ˜…â”‚ â€¢ sticker2 [img]
â”ƒâ˜…â”‚ â€¢ emojimix ğŸ˜+ğŸ˜‚
â”ƒâ˜…â”‚ â€¢ take [name,text]
â”ƒâ˜…â”‚ â€¢ tomp3 [video]
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ“ *Text*
â”ƒâ˜…â”‚ â€¢ fancy [text]
â”ƒâ˜…â”‚ â€¢ tts [text]
â”ƒâ˜…â”‚ â€¢ trt [text]
â”ƒâ˜…â”‚ â€¢ base64 [text]
â”ƒâ˜…â”‚ â€¢ unbase64 [text]
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '8': {
                title: "ğŸ“Œ *Other Menu* ğŸ“Œ",
                content: `â•­â”â”â”ã€” *ğ™¾ğšƒğ™·ğ™´ğš ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ•’ *Utilities*
â”ƒâ˜…â”‚ â€¢ timenow
â”ƒâ˜…â”‚ â€¢ date
â”ƒâ˜…â”‚ â€¢ count [num]
â”ƒâ˜…â”‚ â€¢ calculate [expr]
â”ƒâ˜…â”‚ â€¢ countx
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ² *Random*
â”ƒâ˜…â”‚ â€¢ flip
â”ƒâ˜…â”‚ â€¢ coinflip
â”ƒâ˜…â”‚ â€¢ rcolor
â”ƒâ˜…â”‚ â€¢ roll
â”ƒâ˜…â”‚ â€¢ fact
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ” *Search*
â”ƒâ˜…â”‚ â€¢ define [word]
â”ƒâ˜…â”‚ â€¢ news [query]
â”ƒâ˜…â”‚ â€¢ movie [name]
â”ƒâ˜…â”‚ â€¢ weather [loc]
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '9': {
                title: "ğŸ’ *Reactions Menu* ğŸ’",
                content: `â•­â”â”â”ã€” *ğšğ™´ğ™°ğ™²ğšƒğ™¸ğ™¾ğ™½ğš‚ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ â¤ï¸ *Affection*
â”ƒâ˜…â”‚ â€¢ cuddle @user
â”ƒâ˜…â”‚ â€¢ hug @user
â”ƒâ˜…â”‚ â€¢ kiss @user
â”ƒâ˜…â”‚ â€¢ lick @user
â”ƒâ˜…â”‚ â€¢ pat @user
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ˜‚ *Funny*
â”ƒâ˜…â”‚ â€¢ bully @user
â”ƒâ˜…â”‚ â€¢ bonk @user
â”ƒâ˜…â”‚ â€¢ yeet @user
â”ƒâ˜…â”‚ â€¢ slap @user
â”ƒâ˜…â”‚ â€¢ kill @user
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ˜Š *Expressions*
â”ƒâ˜…â”‚ â€¢ blush @user
â”ƒâ˜…â”‚ â€¢ smile @user
â”ƒâ˜…â”‚ â€¢ happy @user
â”ƒâ˜…â”‚ â€¢ wink @user
â”ƒâ˜…â”‚ â€¢ poke @user
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            },
            '10': {
                title: "ğŸ  *Main Menu* ğŸ ",
                content: `â•­â”â”â”ã€” *ğ™¼ğ™°ğ™¸ğ™½ ğ™¼ğ™´ğ™½ğš„* ã€•â”â”â”â”ˆâŠ·
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ â„¹ï¸ *Bot Info*
â”ƒâ˜…â”‚ â€¢ ping
â”ƒâ˜…â”‚ â€¢ live
â”ƒâ˜…â”‚ â€¢ alive
â”ƒâ˜…â”‚ â€¢ runtime
â”ƒâ˜…â”‚ â€¢ uptime
â”ƒâ˜…â”‚ â€¢ repo
â”ƒâ˜…â”‚ â€¢ owner
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”ƒâ˜…â”‚ ğŸ› ï¸ *Controls*
â”ƒâ˜…â”‚ â€¢ menu
â”ƒâ˜…â”‚ â€¢ menu2
â”ƒâ˜…â”‚ â€¢ restart
â”ƒâ˜…â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ˆâŠ·
${config.FOOTER}`,
                image: true
            }
        };

        // Message handler with improved error handling
        const handler = async (msgData) => {
            try {
                const receivedMsg = msgData.messages[0];
                if (!receivedMsg?.message || !receivedMsg.key?.remoteJid) return;

                const isReplyToMenu = receivedMsg.message.extendedTextMessage?.contextInfo?.stanzaId === messageID;
                
                if (isReplyToMenu) {
                    const receivedText = receivedMsg.message.conversation || 
                                      receivedMsg.message.extendedTextMessage?.text;
                    const senderID = receivedMsg.key.remoteJid;

                    if (menuData[receivedText]) {
                        const selectedMenu = menuData[receivedText];
                        
                        try {
                            
                         if (selectedMenu.image) {
        await conn.sendMessage(
        senderID,
        {
            image: { url: selectedMenu.imageUrl || config.MENU_IMAGE_URL || 'https://files.catbox.moe/3y5w8z.jpg' },
            caption: selectedMenu.content,
            contextInfo: contextInfo
        },
         { quoted: receivedMsg }
       );
          } else {
             await conn.sendMessage(
            senderID,
            { text: selectedMenu.content, contextInfo: contextInfo },
            { quoted: receivedMsg }
    );
}

                            await conn.sendMessage(senderID, {
                                react: { text: 'âœ…', key: receivedMsg.key }
                            });

                        } catch (e) {
                            console.log('Menu reply error:', e);
                            await conn.sendMessage(
                                senderID,
                                { text: selectedMenu.content, contextInfo: contextInfo },
                                { quoted: receivedMsg }
                            );
                        }

                    } else {
                        await conn.sendMessage(
                            senderID,
                            {
                                text: `âŒ *Invalid Option!* âŒ\n\nPlease reply with a number between 1-10 to select a menu.\n\n*Example:* Reply with "1" for Download Menu\n\n${config.FOOTER}`,
                                contextInfo: contextInfo
                            },
                            { quoted: receivedMsg }
                        );
                    }
                }
            } catch (e) {
                console.log('Handler error:', e);
            }
        };

        // Add listener
        conn.ev.on("messages.upsert", handler);

        // Remove listener after 5 minutes
        setTimeout(() => {
            conn.ev.off("messages.upsert", handler);
        }, 300000);

    } catch (e) {
        console.error('Menu Error:', e);
        try {
            await conn.sendMessage(
                from,
                { text: `âŒ Menu system is currently busy. Please try again later.\n\n ${config.FOOTER}` },
                { quoted: mek }
            );
        } catch (finalError) {
            console.log('Final error handling failed:', finalError);
        }
    }
});
