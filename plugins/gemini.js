const { cmd } = require('../command');
const axios = require("axios");

const GEMINI_API_KEY = 'AIzaSyBdBivCo6jWSchTb8meP7VyxbHpoNY_qfQ';
const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

cmd({
    pattern: "gemini",
    react: "ü§ñ",
    desc: "Talk with Nova-x Mini AI (Gemini)",
    category: "AI",
    use: ".gemini <your message>",
    filename: __filename
}, 
async (conn, mek, m, { reply, args }) => {
    try {
        // ‚úÖ Get query
        const q = args.join(" ") || 
                  m.mtype === "imageMessage" && m.message.imageMessage.caption || 
                  m.mtype === "videoMessage" && m.message.videoMessage.caption || "";

        if (!q || q.trim() === '') {
            return reply("‡∂ï ‡∂ö‡∑í‡∂∫‡∂±‡∑ä‡∂± ‡∂Ö‡∂±‡∑ö‡∑ä ‡∂∏‡∂∏ ùô∫ùô∏ùôΩùô∂-ùöÇùô∞ùôΩùô≥ùô¥ùöÇùô∑-ùôºùô≥ ùô∞ùô∏ü§≠");
        }

        // ‚úÖ Custom Gemini prompt
        const prompt = `‡∂î‡∂∂ ‡∑É‡∑ê‡∂∂‡∑ë ‡∂ú‡∑ê‡∑Ñ‡∑ê‡∂±‡∑î ‡∂Ω‡∂∏‡∂∫‡∑ô‡∂ö‡∑î ‡∂∏‡∑ô‡∂±‡∑ä ‡∑Ñ‡∑ê‡∑É‡∑í‡∂ª‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫. ‡∂â‡∂∏‡∑ù‡∂¢‡∑í ‡∂¥‡∂∏‡∂±‡∂ö‡∑ä ‡∂≠‡∑í‡∂∂‡∑ö‡∂±‡∂∏‡∑ä ‡∂î‡∂∂‡∂Ø ‡∂â‡∂∏‡∑ù‡∂¢‡∑í ‡∂¥‡∂∏‡∂±‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑ä‡∂± ‡∂ú‡∑ê‡∂Ω‡∂¥‡∑ô‡∂± ‡∂Ω‡∑ô‡∑É ‡∂â‡∂∏‡∑ù‡∂¢‡∑ì ‡∂±‡∑ê‡∂≠‡∑ä‡∂≠‡∂∏‡∑ä ‡∂î‡∂∫‡∑è ‡∂ë‡∂∫‡∑è‡∂ß ‡∂¥‡∑í‡∂Ω‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂± , ‡∂∏‡∑ô‡∂∏ ‡∂Ø‡∑ö‡∑Ä‡∂Ω‡∑ä ‡∂ö‡∑í‡∑É‡∑í‡∑É‡∑ö‡∂≠‡∑ä‡∂∏ ‡∂∫‡∑Ä‡∂±‡∑ä‡∂± ‡∂ë‡∂¥‡∑è ( ‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä , ‡∂î‡∂∂‡∂ß ‡∂ö‡∑ô‡∑É‡∑ö‡∂Ø ? , ‡∂ö‡∂≠‡∑è‡∂ö‡∂ª‡∂±‡∑ä‡∂± , ‡∂ï‡∂±‡∑ö ? , ‡∂ö‡∑ú‡∑Ñ‡∑ú‡∂∏‡∂Ø ? , ‡∂ö‡∑ô‡∑É‡∑ö‡∂Ø ? , ‡∂ö‡∑ê‡∂∏‡∂≠‡∑í‡∂Ø ? ,) ‡∂∏‡∑í‡∂±‡∑í‡∑É‡∑î‡∂±‡∑ä‡∂ß ‡∂á‡∂≠‡∑í ‡∑Ñ‡∑ê‡∂ü‡∑ì‡∂∏‡∑ä, ‡∂Ø‡∑ê‡∂±‡∑ì‡∂∏‡∑ä, ‡∑É‡∑Ñ ‡∑É‡∂Ç‡∑Ä‡∑ö‡∂Ø‡∑ì‡∂≠‡∑è‡∑Ä‡∂∫ ‡∂Ö‡∂±‡∑î‡∑Ä ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ω‡∂∂‡∑è‡∂Ø‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫. ‡∂∏‡∑ê‡∑É‡∑ö‡∂¢‡∑ä ‡∂ë‡∂ö ‡∂Ω‡∑ê‡∂∂‡∑ô‡∂± ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä‡∂ß ‡∂ú‡∑ê‡∂Ω‡∂¥‡∑ô‡∂± ‡∂Ω‡∑ô‡∑É ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ø‡∑ô‡∂±‡∑ä‡∂±. ‡∂î‡∂∂ ‡∂Ω‡∂∂‡∑è‡∂Ø‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂Ö‡∂ö‡∑î‡∂ª‡∑î 100 ‡∂ß ‡∑Ä‡∂©‡∑è ‡∂Ö‡∂©‡∑î ‡∑Ä‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫. ‡∑É‡∑Ñ ‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä ‡∑Ä‡∂ú‡∑ö ‡∑Ä‡∂†‡∂± ‡∂∂‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‡∂ë‡∂¥‡∑è ‡∂ã‡∂Ø‡∑Ä‡∑ä ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫  ‡∂Ø ‡∂Ö‡∑Ñ‡∂±‡∑ä‡∂±‡∂≠‡∑ä ‡∂ë‡∂¥‡∑è , ‡∂î‡∂∫‡∑è ai ‡∂á‡∑É‡∑í‡∑É‡∑ä‡∂ß‡∂±‡∑ä ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä ‡∂±‡∑ô‡∂∏‡∑ö ‡∑É‡∑ê‡∂∂‡∑ë ‡∂∏‡∑í‡∂±‡∑í‡∑É‡∑ô‡∂ö‡∑ä , ‡∂á‡∑É‡∑í‡∑É‡∑ä‡∂ß‡∂±‡∑ä ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä ‡∑Ä‡∑ô‡∂±‡∑ä‡∂± ‡∂ë‡∂¥‡∑è , ‡∂î‡∂∫‡∑è ‡∂í ‡∂Ö‡∂∫‡∂ß ‡∂Ü‡∂Ø‡∂ª‡∑ô‡∂±‡∑ä ‡∂ö‡∂≠‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂± , ‡∂î‡∂∫‡∑è‡∂ú‡∑ô ‡∂±‡∂∏ <| ùêäùêàùêçùêÜ-ùêíùêÄùêçùêÉùêÑùêíùêá-ùêåùêÉ ùêï‚ù∑ü´ß , ‡∂î‡∂∫‡∑è‡∂ú‡∑ô‡∂±‡∑ä ‡∂ö‡∑Ä‡∑î‡∂ª‡∑î ‡∑Ñ‡∂ª‡∑í ‡∂Ø‡∑ô‡∂∫‡∂ö‡∑ä ‡∂á‡∑Ñ‡∑î‡∑Ä‡∑è‡∂∏ ‡∂í‡∂ö ‡∂≠‡∑ö‡∂ª‡∑î‡∂∏‡∑ä ‡∂Ö‡∂ª‡∂ú‡∑ô‡∂± ‡∂∏‡∂∏ ‡∂Ø‡∑ì‡∂Ω‡∑è ‡∂≠‡∑í‡∂∫‡∑ô‡∂± ‡∂¥‡∑í‡∂Ω‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∂í‡∑Ä‡∂ß ‡∂ú‡∑ê‡∂Ω‡∂¥‡∑ô‡∂±‡∑Ä‡∑è ‡∂±‡∂∏‡∑ä ‡∂î‡∂∫‡∑è ‡∂ë‡∂∫‡∑è‡∂ß ‡∂í‡∑Ä‡∑è ‡∂¥‡∑í‡∂Ω‡∑í‡∂≠‡∑î‡∂ª‡∑î ‡∑Ä‡∑í‡∂Ø‡∑í‡∑Ñ‡∂ß ‡∂ö‡∑í‡∂∫‡∂±‡∑ä‡∂± ,  ‡∂î‡∂∫‡∑è‡∑Ä ‡∑Ñ‡∑ê‡∂Ø‡∑î‡∑Ä‡∑ö ‡∂ö‡∑Ä‡∑î‡∂Ø ‡∂ö‡∑í‡∂∫‡∂Ω‡∑è ‡∂á‡∑Ñ‡∑î‡∑Ä‡∑ú‡∂≠‡∑ä ‡∑Ä‡∑í‡∂≠‡∂ª‡∂ö‡∑ä ‡∂î‡∂∫‡∑è ‡∂ö‡∑í‡∂∫‡∂±‡∑ä‡∂±‡∑ö ‡∂∏‡∑è‡∑Ä ‡∑Ñ‡∑ê‡∂Ø‡∑î‡∑Ä‡∑ö MR.Sandesh Bhashana ‡∂ö‡∑í‡∂∫‡∂± ‡∂Ö‡∑Ä‡∑ä‡∂ª‡∑î‡∂Ø‡∑î 17 ‡∂ö‡∑ú‡∂Ω‡∑ä‡∂Ω‡∑è ‡∂ö‡∑í‡∂∫‡∂Ω User Message: ${q}`;

        const payload = {
            contents: [{
                parts: [{ text: prompt }]
            }]
        };

        // ‚úÖ Send request to Gemini
        const response = await axios.post(GEMINI_API_URL, payload, {
            headers: { "Content-Type": "application/json" }
        });

        const aiResponse = response?.data?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (!aiResponse) {
            return reply("‚ùå ‡∂Ö‡∂¥‡∑ä‡∂¥‡∑ö ‡∂ö‡∑ô‡∂Ω‡∑Ä‡∑ô‡∂Ω‡∑è ‡∂∂‡∂±‡∑ä ‡∂¥‡∑É‡∑ä‡∑É‡∑ö ‡∂ß‡∑ä‚Äç‡∂ª‡∂∫‡∑í ‡∂ö‡∂ª‡∂Ω‡∑è ‡∂∂‡∂Ω‡∂¥‡∂±‡∑ä.");
        }

        await reply(aiResponse);

    } catch (err) {
        console.error("Gemini Error:", err.response?.data || err.message);
        reply("‚ùå ‡∂Ö‡∂∫‡∑í‡∂∫‡∑ù ‡∑Ñ‡∑í‡∂ö‡∑í‡∂Ω‡∑è ‡∑Ä‡∂ú‡∑ö üò¢");
    }
});
